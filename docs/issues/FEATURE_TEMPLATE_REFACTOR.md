# Feature: Template System Refactor

## Overview
Simplify template generation after `ThemeFolder` removal. Templates generate defaults when no content exists.

## Related Documents
- [FEATURE_CONFIG_SIMPLIFICATION.md](FEATURE_CONFIG_SIMPLIFICATION.md) - ThemeFolder removal (prerequisite)
- [FEATURE_HTTP_ROUTES_WORK_MODES.md](FEATURE_HTTP_ROUTES_WORK_MODES.md) - Defines `AssetsURLPrefix`

## Current Problems

1. **Wrong location**: `htmlGenerator.go` methods are on `AssetMin`, should be on `asset`
2. **Hardcoded paths**: Template `index_basic.html` has hardcoded asset paths
3. **Disk-first approach**: Current methods write directly to disk, violating new work mode paradigm
4. **ThemeFolder complexity**: Removed - all files now in `OutputDir`

## Requirements

### 1. Dynamic Template Content

Templates must use configured `AssetsURLPrefix`:

**Without prefix (`AssetsURLPrefix = ""`):**
```html
<link rel="stylesheet" href="/style.css" />
<script src="/script.js"></script>
<link rel="icon" href="/favicon.svg" />
```

**With prefix (`AssetsURLPrefix = "/assets/"`):**
```html
<link rel="stylesheet" href="/assets/style.css" />
<script src="/assets/script.js"></script>
<link rel="icon" href="/assets/favicon.svg" />
```

### 2. Move Template Logic to asset

Each `asset` should know how to generate its default content:

```go
type asset struct {
    // ... existing fields ...
    
    defaultTemplate func() []byte  // Returns default content if no source exists
}
```

### 3. Template Generation on Demand

Instead of writing to disk on `NewAssetMin()`:
1. Store default template generator in `asset`
2. On first content request (HTTP or disk write), if no source content exists, use default template
3. Template is processed through normal minification pipeline

### 4. Template Placeholders

Templates should support placeholders:
- `{{.AppName}}` - Application name
- `{{.CSSPath}}` - Full CSS URL path (with prefix)
- `{{.JSPath}}` - Full JS URL path (with prefix)
- `{{.FaviconPath}}` - Full favicon URL path (with prefix)

### 5. Updated index_basic.html

```html
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.AppName}}</title>
    <link rel="icon" type="image/svg+xml" href="{{.FaviconPath}}" />
    <link rel="stylesheet" href="{{.CSSPath}}" type="text/css" />
</head>
<body>
    <h1>Welcome to {{.AppName}}</h1>
    <p>This is a basic HTML template generated by AssetMin.</p>
    
    <script src="{{.JSPath}}" type="text/javascript"></script>
</body>
</html>
```

## Files to Modify

| File | Changes |
|------|---------|
| `asset.go` | Add `defaultTemplate` field, template methods |
| `htmlGenerator.go` | Remove ThemeFolder checks, simplify |
| `assetmin.go` | Pass `AssetsURLPrefix` to asset initialization |
| `templates/index_basic.html` | Update with dynamic placeholders |

## Simplified Workflow (Post-ThemeFolder Removal)

1. `asset` has `defaultTemplate` function
2. If `contentOpen/Middle/Close` are empty, use default template
3. Template is minified and cached like normal content
4. No disk check needed - if user wants custom, they register via `NewFileEvent`

## Default Content Initialization

On `NewAssetMin()` or first HTTP request:
1. If asset has no registered content AND has `defaultTemplate`:
   - Call `defaultTemplate()` to get initial content
   - Store in `contentOpen` (for HTML) or `contentMiddle` (for others)
   - Set `cacheValid = false` to trigger minification

```go
func (h *asset) ensureDefaultContent() {
    if h.defaultTemplate == nil {
        return
    }
    if len(h.contentOpen) == 0 && len(h.contentMiddle) == 0 && len(h.contentClose) == 0 {
        h.contentMiddle = []*contentFile{{
            path:    "default-template",
            content: h.defaultTemplate(),
        }}
    }
}
```

## Breaking Changes

- `CreateDefaultIndexHtmlIfNotExist()` - **REMOVE** (no deprecation)
- `CreateDefaultCssIfNotExist()` - **REMOVE**
- `CreateDefaultJsIfNotExist()` - **REMOVE**
- `CreateDefaultFaviconIfNotExist()` - **REMOVE**

**Reason**: With `MemoryMode` default, these methods have no purpose. Defaults are served from memory automatically.
